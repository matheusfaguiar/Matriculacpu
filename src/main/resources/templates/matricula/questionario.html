<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Questionário Sócio Econômico</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div th:fragment="content">
  <div class="container mt-3 mt-md-4">
    <!-- Cabeçalho -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="h4 h3-md"><i class="fas fa-file-alt me-2"></i>Questionário de Matrícula</h2>
    </div>

    <!-- Sumário do curso -->
    <div class="alert alert-info mb-4 shadow-sm">
      <h5 class="mb-1 fw-bold" th:text="${curso.nomeExibicao}">Nome do Curso</h5>
      <small>
        Local: <span th:text="${curso.lotacao?.nome}">Local</span> |
        Carga Horária: <span th:text="${curso.cargaHoraria}">40</span>h |
        Período: <span th:text="${#temporals.format(curso.dataInicio,'dd/MM/yyyy')}">01/01</span>
        a <span th:text="${#temporals.format(curso.dataFim,'dd/MM/yyyy')}">02/02</span>
      </small>
    </div>

    <!-- Mensagens de erro -->
    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
      <span th:text="${errorMessage}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="card shadow border-0 rounded-3">
      <div class="card-header bg-primary text-white rounded-top-3">
        <h4 class="card-title mb-0">
          <i class="fas fa-file-text me-2"></i>Questionário Sócio Econômico
        </h4>
      </div>

      <div class="card-body p-3 p-md-4 bg-light">
        <form th:action="@{/matricula/concluir}" 
              th:object="${questionario}" 
              method="post" 
              class="needs-validation" 
              novalidate
              onsubmit="return validarFormulario()">

          <!-- CORREÇÃO: Campo matriculaId como hidden field -->
          <input type="hidden" th:field="*{matriculaId}" />
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

         <!-- SEÇÃO: Dados do Usuário -->
         <div class="card mb-4 shadow-sm border-0 rounded-3">
             <div class="card-header bg-secondary text-white rounded-top-3">
                 <h5 class="mb-0"><i class="fas fa-user-circle me-2"></i>Seus Dados de Cadastro</h5>
             </div>
             <div class="card-body bg-white">
               <!-- Mensagem de alerta para confirmar/atualizar dados -->
               <div class="alert alert-info d-flex align-items-center mb-4" role="alert">
                   <i class="fas fa-info-circle fa-lg me-3 text-info"></i>
                   <div class="flex-grow-1">
                       <h6 class="alert-heading mb-1">Confirme e atualize seus dados cadastrais:</h6>
                       
                   </div>
               </div>
               
               <!-- Inclui os campos do usuário leitura -->
               <div th:replace="~{usuario/campos-usuario :: campos-usuario(
                   perfis=${perfis},
                   canEditPerfil=false,
                   modalId='questionario',
                   lotacoesDisponiveis=null
               )}"></div>
           </div>
         </div>
         
          <!-- SEÇÃO: Endereço -->
          <div class="card mb-4 shadow-sm border-0 rounded-3">
            <div class="card-header bg-info text-white rounded-top-3">
              <h5 class="mb-0"><i class="fas fa-map-marker-alt me-2"></i>Dados de Endereço</h5>
            </div>
            <div class="card-body bg-white">
              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <label class="form-label">Endereço <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" th:field="*{endereco}" 
                         th:classappend="${#fields.hasErrors('endereco')} ? 'is-invalid' : ''"
                         required />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('endereco')}">
                    <span th:errors="*{endereco}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe seu endereço.</div>
                </div>
                <div class="col-12 col-md-3">
                  <label class="form-label">Bairro <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" th:field="*{bairro}" 
                         th:classappend="${#fields.hasErrors('bairro')} ? 'is-invalid' : ''"
                         required />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('bairro')}">
                    <span th:errors="*{bairro}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe seu bairro.</div>
                </div>
                <div class="col-12 col-md-3">
                  <label class="form-label">CEP <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" th:field="*{cep}" 
                        placeholder="00000-000"
                        th:classappend="${#fields.hasErrors('cep')} ? 'is-invalid' : ''"
                        oninput="formatarCEP(this)"
                        required />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('cep')}">
                    <span th:errors="*{cep}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe seu CEP.</div>
                </div>
              </div>
              <div class="row g-3 mt-2">
                <div class="col-12 col-md-4">
                  <label class="form-label">Cidade <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" th:field="*{cidade}" 
                         th:classappend="${#fields.hasErrors('cidade')} ? 'is-invalid' : ''"
                         required />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('cidade')}">
                    <span th:errors="*{cidade}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe sua cidade.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- SEÇÃO: Escolaridade -->
          <div class="card mb-4 shadow-sm border-0 rounded-3">
            <div class="card-header bg-warning text-dark rounded-top-3">
              <h5 class="mb-0"><i class="fas fa-graduation-cap me-2"></i>Escolaridade</h5>
            </div>
            <div class="card-body bg-white">
              <div class="row g-3">
                <div class="col-12 col-md-4">
                  <label class="form-label d-block">Está estudando? <span class="text-danger">*</span></label>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio"
                           th:field="*{estaEstudando}" th:value="true" id="estaEstudandoSim"
                           onchange="toggleEstudandoFields()" required>
                    <label class="form-check-label" for="estaEstudandoSim">Sim</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio"
                           th:field="*{estaEstudando}" th:value="false" id="estaEstudandoNao"
                           onchange="toggleEstudandoFields()" required>
                    <label class="form-check-label" for="estaEstudandoNao">Não</label>
                  </div>
                  <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('estaEstudando')}">
                    <span th:errors="*{estaEstudando}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione uma opção.</div>
                </div>
                <div class="col-12 col-md-4" id="motivoNaoEstudarField" style="display: none;">
                  <label class="form-label">Por quê? <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" th:field="*{motivoNaoEstudar}" 
                         th:classappend="${#fields.hasErrors('motivoNaoEstudar')} ? 'is-invalid' : ''" />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('motivoNaoEstudar')}">
                    <span th:errors="*{motivoNaoEstudar}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe o motivo.</div>
                </div>
              </div>

              <div class="row g-3 mt-3" id="estudandoFields" style="display: none;">
                <div class="col-12 col-md-4">
                  <label class="form-label">Nome da Escola <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" th:field="*{nomeEscola}"
                         th:classappend="${#fields.hasErrors('nomeEscola')} ? 'is-invalid' : ''"
                         required />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('nomeEscola')}">
                    <span th:errors="*{nomeEscola}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe o nome da escola.</div>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label">Série Escolar <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" th:field="*{serieEscolar}"
                         th:classappend="${#fields.hasErrors('serieEscolar')} ? 'is-invalid' : ''"
                         required />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('serieEscolar')}">
                    <span th:errors="*{serieEscolar}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe a série escolar.</div>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label">Turno <span class="text-danger">*</span></label>
                  <select class="form-select" th:field="*{turno}"
                          th:classappend="${#fields.hasErrors('turno')} ? 'is-invalid' : ''"
                          required>
                    <option value="" disabled selected>Selecione...</option>
                    <option value="Manhã">Manhã</option>
                    <option value="Tarde">Tarde</option>
                    <option value="Noite">Noite</option>
                  </select>
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('turno')}">
                    <span th:errors="*{turno}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione o turno.</div>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label">Tipo de Escola <span class="text-danger">*</span></label>
                  <select class="form-select" th:field="*{tipoEscola}"
                          th:classappend="${#fields.hasErrors('tipoEscola')} ? 'is-invalid' : ''"
                          required>
                    <option value="" disabled selected>Selecione...</option>
                    <option value="Estadual">Estadual</option>
                    <option value="Municipal">Municipal</option>
                    <option value="Particular">Particular</option>
                  </select>
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('tipoEscola')}">
                    <span th:errors="*{tipoEscola}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione o tipo de escola.</div>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label d-block">Fez ENEM? <span class="text-danger">*</span></label>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" 
                           th:field="*{fezEnem}" th:value="true" id="fezEnemSim"
                           required>
                    <label class="form-check-label" for="fezEnemSim">Sim</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" 
                           th:field="*{fezEnem}" th:value="false" id="fezEnemNao"
                           required>
                    <label class="form-check-label" for="fezEnemNao">Não</label>
                  </div>
                  <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('fezEnem')}">
                    <span th:errors="*{fezEnem}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione uma opção.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- SEÇÃO: Perfil -->
          <div class="card mb-4 shadow-sm border-0 rounded-3">
            <div class="card-header bg-success text-white rounded-top-3">
              <h5 class="mb-0"><i class="fas fa-users me-2"></i>Perfil</h5>
            </div>
            <div class="card-body bg-white">
              <div class="row g-3">
                <div class="col-12 col-md-4">
                  <label class="form-label">Etnia / Cor <span class="text-danger">*</span></label>
                  <select class="form-select" th:field="*{etniaCor}"
                          th:classappend="${#fields.hasErrors('etniaCor')} ? 'is-invalid' : ''"
                          required>
                    <option value="" disabled selected>Selecione...</option>
                    <option value="Branco">Branco</option>
                    <option value="Parda">Parda</option>
                    <option value="Negra">Negra</option>
                    <option value="Oriental">Oriental</option>
                    <option value="Indígena">Indígena</option>
                  </select>
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('etniaCor')}">
                    <span th:errors="*{etniaCor}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione sua etnia/cor.</div>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label">Religião <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" th:field="*{religiao}"
                         th:classappend="${#fields.hasErrors('religiao')} ? 'is-invalid' : ''"
                         required />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('religiao')}">
                    <span th:errors="*{religiao}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe sua religião.</div>
                </div>
              </div>
              <div class="row g-3 mt-3">
                <div class="col-12 col-md-4">
                  <label class="form-label d-block">Participa de algum programa social? <span class="text-danger">*</span></label>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" 
                           th:field="*{participaProgramaSocial}" th:value="true" id="participaProgramaSim"
                           onchange="toggleProgramaSocialField()" required>
                    <label class="form-check-label" for="participaProgramaSim">Sim</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" 
                           th:field="*{participaProgramaSocial}" th:value="false" id="participaProgramaNao"
                           onchange="toggleProgramaSocialField()" required>
                    <label class="form-check-label" for="participaProgramaNao">Não</label>
                  </div>
                  <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('participaProgramaSocial')}">
                    <span th:errors="*{participaProgramaSocial}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione uma opção.</div>
                </div>
                <div class="col-12 col-md-4" id="qualProgramaSocialField" style="display: none;">
                  <label class="form-label">Qual? <span class="text-danger">*</span></label>
                  <select class="form-select" th:field="*{qualProgramaSocial}"
                          th:classappend="${#fields.hasErrors('qualProgramaSocial')} ? 'is-invalid' : ''">
                    <option value="" disabled selected>Selecione...</option>
                    <option value="Bolsa Família">Bolsa Família</option>
                    <option value="BPC">BPC</option>
                    <option value="Seguro Desemprego">Seguro Desemprego</option>
                    <option value="Auxílio Doença">Auxílio Doença</option>
                    <option value="Cheque Moradia">Cheque Moradia</option>
                    <option value="Outros">Outros</option>
                  </select>
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('qualProgramaSocial')}">
                    <span th:errors="*{qualProgramaSocial}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione o programa social.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- SEÇÃO: Saúde -->
          <div class="card mb-4 shadow-sm border-0 rounded-3">
            <div class="card-header bg-danger text-white rounded-top-3">
              <h5 class="mb-0"><i class="fas fa-heartbeat me-2"></i>Saúde</h5>
            </div>
            <div class="card-body bg-white">
              <div class="row g-3">
                <div class="col-12 col-md-4">
                  <label class="form-label d-block">Possui algum tipo de transtorno/deficiência? <span class="text-danger">*</span></label>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio"
                           th:field="*{possuiTranstornoDeficiencia}" th:value="true" id="transtornoSim"
                           onchange="toggleDeficienciaField()" required>
                    <label class="form-check-label" for="transtornoSim">Sim</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio"
                           th:field="*{possuiTranstornoDeficiencia}" th:value="false" id="transtornoNao"
                           onchange="toggleDeficienciaField()" required>
                    <label class="form-check-label" for="transtornoNao">Não</label>
                  </div>
                  <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('possuiTranstornoDeficiencia')}">
                    <span th:errors="*{possuiTranstornoDeficiencia}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione uma opção.</div>
                </div>
                <div class="col-12 col-md-8" id="tipoDeficienciaField" style="display: none;">
                  <label class="form-label">Qual/quais? <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" th:field="*{tipoDeficiencia}"
                         th:classappend="${#fields.hasErrors('tipoDeficiencia')} ? 'is-invalid' : ''" />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('tipoDeficiencia')}">
                    <span th:errors="*{tipoDeficiencia}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe o tipo de transtorno/deficiência.</div>
                </div>
              </div>

              <div class="row g-3 mt-3">
                <div class="col-12 col-md-6">
                  <label class="form-label d-block">Faz uso de medicação controlada? <span class="text-danger">*</span></label>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio"
                          th:field="*{usoMedicacaoControlada}" th:value="true" id="usoMedicacaoSim"
                          onchange="toggleMedicacaoField()" required>
                    <label class="form-check-label" for="usoMedicacaoSim">Sim</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio"
                          th:field="*{usoMedicacaoControlada}" th:value="false" id="usoMedicacaoNao"
                          onchange="toggleMedicacaoField()" required>
                    <label class="form-check-label" for="usoMedicacaoNao">Não</label>
                  </div>
                  <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('usoMedicacaoControlada')}">
                    <span th:errors="*{usoMedicacaoControlada}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione uma opção.</div>
                </div>
              </div>

              <div class="row g-3 mt-3" id="medicacaoDetalhesField" style="display: none;">
                <div class="col-12 col-md-8">
                  <label class="form-label">De quais medicações faz uso? E por quê? <span class="text-danger">*</span></label>
                  <textarea class="form-control" th:field="*{quaisMedicacoes}" rows="3"
                            th:classappend="${#fields.hasErrors('quaisMedicacoes')} ? 'is-invalid' : ''"
                            placeholder="Informe o nome dos medicamentos e o motivo do uso..."></textarea>
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('quaisMedicacoes')}">
                    <span th:errors="*{quaisMedicacoes}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe sobre as medicações em uso.</div>
                </div>
              </div>
              
              <div class="row g-3 mt-3">
                <div class="col-12 col-md-4">
                  <label class="form-label d-block">É acompanhado na UBS? <span class="text-danger">*</span></label>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio"
                          th:field="*{acompanhadoUbs}" th:value="true" id="ubsSim"
                          onchange="toggleAcompanhamentoField()" required>
                    <label class="form-check-label" for="ubsSim">Sim</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio"
                          th:field="*{acompanhadoUbs}" th:value="false" id="ubsNao"
                          onchange="toggleAcompanhamentoField()" required>
                    <label class="form-check-label" for="ubsNao">Não</label>
                  </div>
                  <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('acompanhadoUbs')}">
                    <span th:errors="*{acompanhadoUbs}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione uma opção.</div>
                </div>
              
                <div class="col-12 col-md-8" id="tipoAcompanhamentoField" style="display: none;">
                  <label class="form-label">Que tipo de acompanhamento? <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" th:field="*{tipoAcompanhamento}"
                         th:classappend="${#fields.hasErrors('tipoAcompanhamento')} ? 'is-invalid' : ''" />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('tipoAcompanhamento')}">
                    <span th:errors="*{tipoAcompanhamento}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe o tipo de acompanhamento.</div>
                </div>
              </div>
            </div>
          </div>
        
          <!-- SEÇÃO: Família -->
          <div class="card mb-4 shadow-sm border-0 rounded-3">
            <div class="card-header bg-secondary text-white rounded-top-3">
              <h5 class="mb-0"><i class="fas fa-home me-2"></i>Família e Moradia</h5>
            </div>
            <div class="card-body bg-white">
              <div class="row g-3">
                <div class="col-12 col-md-3">
                  <label class="form-label">Quantas pessoas há na sua família? <span class="text-danger">*</span></label>
                  <!-- CORREÇÃO: Campo numérico com validação -->
                  <input type="number" class="form-control" name="qtdPessoasFamilia" 
                         th:value="${questionario.qtdPessoasFamilia}" 
                         min="1" max="20" step="1"
                         th:classappend="${#fields.hasErrors('qtdPessoasFamilia')} ? 'is-invalid' : ''"
                         required 
                         oninput="validarNumero(this)" />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('qtdPessoasFamilia')}">
                    <span th:errors="*{qtdPessoasFamilia}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe um número entre 1 e 20.</div>
                </div>
                <div class="col-12 col-md-3">
                  <label class="form-label">Renda familiar <span class="text-danger">*</span></label>
                  <select class="form-select" th:field="*{rendaFamiliar}"
                          th:classappend="${#fields.hasErrors('rendaFamiliar')} ? 'is-invalid' : ''"
                          required>
                    <option value="" disabled selected>Selecione...</option>
                    <option value="Menos de 1 salário">Menos de 1 salário</option>
                    <option value="Até 1 salário">Até 1 salário</option>
                    <option value="Até 2 salários">Até 2 salários</option>
                    <option value="Até 3 salários">Até 3 salários</option>
                    <option value="Mais de 3 salários">Mais de 3 salários</option>
                  </select>
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('rendaFamiliar')}">
                    <span th:errors="*{rendaFamiliar}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione a renda familiar.</div>
                </div>
              </div>

              <div class="row g-3 mt-3">
                <div class="col-12 col-md-4">
                  <label class="form-label">Número de cômodos <span class="text-danger">*</span></label>
                  <!-- CORREÇÃO: Campo numérico com validação -->
                  <input type="number" class="form-control" name="numeroComodos" 
                         th:value="${questionario.numeroComodos}"
                         min="1" max="20" step="1"
                         th:classappend="${#fields.hasErrors('numeroComodos')} ? 'is-invalid' : ''"
                         required 
                         oninput="validarNumero(this)" />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('numeroComodos')}">
                    <span th:errors="*{numeroComodos}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe um número entre 1 e 20.</div>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label">Condição de Moradia <span class="text-danger">*</span></label>
                  <select class="form-select" th:field="*{condicaoMoradia}"
                          th:classappend="${#fields.hasErrors('condicaoMoradia')} ? 'is-invalid' : ''"
                          required>
                    <option value="" disabled selected>Selecione...</option>
                    <option value="Própria">Própria</option>
                    <option value="Alugada">Alugada</option>
                    <option value="Cedida">Cedida</option>
                    <option value="Ocupação Irregular">Ocupação Irregular</option>
                  </select>
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('condicaoMoradia')}">
                    <span th:errors="*{condicaoMoradia}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione a condição de moradia.</div>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label">Tipo de Moradia <span class="text-danger">*</span></label>
                  <select class="form-select" th:field="*{tipoMoradia}"
                          th:classappend="${#fields.hasErrors('tipoMoradia')} ? 'is-invalid' : ''"
                          required>
                    <option value="" disabled selected>Selecione...</option>
                    <option value="Alvenaria">Alvenaria</option>
                    <option value="Madeira">Madeira</option>
                    <option value="Mista">Mista</option>
                    <option value="Barro">Barro</option>
                    <option value="Outros">Outros</option>
                  </select>
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('tipoMoradia')}">
                    <span th:errors="*{tipoMoradia}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione o tipo de moradia.</div>
                </div>
              </div>

              <div class="row g-3 mt-3">
                <div class="col-12 col-md-4">
                  <label class="form-label">Situação ocupacional do chefe de família <span class="text-danger">*</span></label>
                  <select class="form-select" th:field="*{situacaoOcupacionalChefe}"
                          th:classappend="${#fields.hasErrors('situacaoOcupacionalChefe')} ? 'is-invalid' : ''"
                          required>
                    <option value="" disabled selected>Selecione...</option>
                    <option value="Empregado">Empregado</option>
                    <option value="Desempregado">Desempregado</option>
                    <option value="Autônomo">Autônomo</option>
                    <option value="Aposentado">Aposentado</option>
                    <option value="Faz Bico">Faz Bico</option>
                  </select>
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('situacaoOcupacionalChefe')}">
                    <span th:errors="*{situacaoOcupacionalChefe}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione a situação ocupacional.</div>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label">Profissão (Formal ou Informal) <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" th:field="*{profissaoOcupacao}"
                         th:classappend="${#fields.hasErrors('profissaoOcupacao')} ? 'is-invalid' : ''"
                         required />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('profissaoOcupacao')}">
                    <span th:errors="*{profissaoOcupacao}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe a profissão.</div>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label">Contato de Emergência <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" name="contatoUrgencia" 
                         th:value="${questionario.contatoUrgencia}"
                         placeholder="(00) 00000-0000"
                         th:classappend="${#fields.hasErrors('contatoUrgencia')} ? 'is-invalid' : ''"
                         required />
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('contatoUrgencia')}">
                    <span th:errors="*{contatoUrgencia}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, informe um contato de emergência.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12 col-md-6">
                  <label class="form-label">Como soube da Fundação ParáPaz? <span class="text-danger">*</span></label>
                  <select class="form-select" th:field="*{comoSoubeParapaz}"
                          th:classappend="${#fields.hasErrors('comoSoubeParapaz')} ? 'is-invalid' : ''"
                          required>
                    <option value="" disabled selected>Selecione uma opção</option>
                    <option value="televisao">Televisão</option>
                    <option value="internet">Internet</option>
                    <option value="parentes">Parentes</option>
                    <option value="vizinhos">Vizinhos</option>
                    <option value="outros">Outros</option>
                  </select>
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('comoSoubeParapaz')}">
                    <span th:errors="*{comoSoubeParapaz}"></span>
                  </div>
                  <div class="invalid-feedback">Por favor, selecione como soube da Fundação ParáPaz.</div>
                </div>

          <!-- Botões -->
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mt-4 pt-3 border-top">
            <a th:href="@{/}" class="btn btn-outline-secondary mb-2 mb-md-0">
              <i class="fas fa-arrow-left me-1"></i>Cancelar
            </a>
            <button type="submit" class="btn btn-success px-4 py-2 shadow-sm">
              <i class="fas fa-check-circle me-1"></i> Concluir Matrícula
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
// Função para validar números
function validarNumero(input) {
    // Remove qualquer caractere que não seja número
    input.value = input.value.replace(/[^0-9]/g, '');
    
    // Valida o range
    const value = parseInt(input.value) || 0;
    const min = parseInt(input.min) || 1;
    const max = parseInt(input.max) || 20;
    
    if (value < min) {
        input.value = min;
    } else if (value > max) {
        input.value = max;
    }
}

// Função para validar todo o formulário antes do envio
function validarFormulario() {
    const forms = document.querySelectorAll('.needs-validation');
    let isValid = true;
    
    Array.prototype.slice.call(forms).forEach(function (form) {
        if (!form.checkValidity()) {
            isValid = false;
        }
        form.classList.add('was-validated');
    });
    
    // Validação adicional para campos numéricos
    const camposNumericos = document.querySelectorAll('input[type="number"]');
    camposNumericos.forEach(campo => {
        if (campo.value && isNaN(campo.value)) {
            campo.classList.add('is-invalid');
            isValid = false;
        }
    });
    
    return isValid;
}

function toggleEstudandoFields() {
    const estaEstudandoSim = document.getElementById('estaEstudandoSim');
    const estaEstudandoNao = document.getElementById('estaEstudandoNao');
    
    const estudandoFields = document.getElementById('estudandoFields');
    const motivoNaoEstudarField = document.getElementById('motivoNaoEstudarField');
    
    if (estaEstudandoSim.checked) {
        estudandoFields.style.display = 'flex';
        motivoNaoEstudarField.style.display = 'none';
        // Torna os campos obrigatórios
        estudandoFields.querySelectorAll('input, select').forEach(field => {
            field.required = true;
        });
        if (document.querySelector('[name="motivoNaoEstudar"]')) {
            document.querySelector('[name="motivoNaoEstudar"]').required = false;
        }
    } else if (estaEstudandoNao.checked) {
        estudandoFields.style.display = 'none';
        motivoNaoEstudarField.style.display = 'block';
        // Torna o campo obrigatório
        if (document.querySelector('[name="motivoNaoEstudar"]')) {
            document.querySelector('[name="motivoNaoEstudar"]').required = true;
        }
        // Remove obrigatoriedade dos outros campos
        estudandoFields.querySelectorAll('input, select').forEach(field => {
            field.required = false;
        });
    }
}

// Função para mostrar/ocultar campo de programa social
function toggleProgramaSocialField() {
    const participaProgramaSim = document.getElementById('participaProgramaSim');
    const qualProgramaSocialField = document.getElementById('qualProgramaSocialField');
    
    if (participaProgramaSim.checked) {
        qualProgramaSocialField.style.display = 'block';
        if (qualProgramaSocialField.querySelector('select')) {
            qualProgramaSocialField.querySelector('select').required = true;
        }
    } else {
        qualProgramaSocialField.style.display = 'none';
        if (qualProgramaSocialField.querySelector('select')) {
            qualProgramaSocialField.querySelector('select').required = false;
        }
    }
}

// Função para mostrar/ocultar campo de deficiência
function toggleDeficienciaField() {
    const possuiTranstornoSim = document.getElementById('transtornoSim');
    const tipoDeficienciaField = document.getElementById('tipoDeficienciaField');
    
    if (possuiTranstornoSim.checked) {
        tipoDeficienciaField.style.display = 'block';
        if (tipoDeficienciaField.querySelector('input')) {
            tipoDeficienciaField.querySelector('input').required = true;
        }
    } else {
        tipoDeficienciaField.style.display = 'none';
        if (tipoDeficienciaField.querySelector('input')) {
            tipoDeficienciaField.querySelector('input').required = false;
        }
    }
}

function toggleMedicacaoField() {
    const usoMedicacaoSim = document.getElementById('usoMedicacaoSim');
    const medicacaoDetalhesField = document.getElementById('medicacaoDetalhesField');
    
    if (usoMedicacaoSim.checked) {
        medicacaoDetalhesField.style.display = 'block';
        if (medicacaoDetalhesField.querySelector('textarea')) {
            medicacaoDetalhesField.querySelector('textarea').required = true;
        }
    } else {
        medicacaoDetalhesField.style.display = 'none';
        if (medicacaoDetalhesField.querySelector('textarea')) {
            medicacaoDetalhesField.querySelector('textarea').required = false;
        }
    }
}

// Função para mostrar/ocultar campo de acompanhamento
function toggleAcompanhamentoField() {
    const acompanhadoUBSSim = document.getElementById('ubsSim');
    const tipoAcompanhamentoField = document.getElementById('tipoAcompanhamentoField');
    
    if (acompanhadoUBSSim.checked) {
        tipoAcompanhamentoField.style.display = 'block';
        if (tipoAcompanhamentoField.querySelector('input')) {
            tipoAcompanhamentoField.querySelector('input').required = true;
        }
    } else {
        tipoAcompanhamentoField.style.display = 'none';
        if (tipoAcompanhamentoField.querySelector('input')) {
            tipoAcompanhamentoField.querySelector('input').required = false;
        }
    }
}

function formatarCEP(input) {
    // Remove tudo que não é número
    let cep = input.value.replace(/\D/g, '');
    
    // Aplica máscara visual (não altera o valor real)
    if (cep.length > 5) {
        cep = cep.substring(0, 5) + '-' + cep.substring(5, 8);
    }
    
    // Atualiza visualmente (mas o th:field mantém o valor original)
    input.value = cep;
}

// Inicializar campos ao carregar a página
document.addEventListener('DOMContentLoaded', function() {
    // Inicializar campos condicionais
    toggleEstudandoFields();
    toggleProgramaSocialField();
    toggleDeficienciaField();
    toggleAcompanhamentoField();
    
    // Validação do Bootstrap
    const forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms).forEach(function (form) {
        form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });
    
    // Aplicar máscaras
    if (typeof $.fn.mask === 'function') {
        $('[name="contatoUrgencia"]').mask('(00) 00000-0000');
    
    }

    const cepInput = document.querySelector('[th\\:field="*{cep}"]');
    if (cepInput && cepInput.value) {
        formatarCEP(cepInput);
    }
});



// Responsividade: ajustar layout em telas pequenas
function adjustLayoutForMobile() {
    if (window.innerWidth < 768) {
        document.querySelectorAll('.card-body .row').forEach(row => {
            row.classList.add('g-2');
        });
    }
}

window.addEventListener('resize', adjustLayoutForMobile);
window.addEventListener('load', adjustLayoutForMobile);
</script>
</body>
</html>