<div th:fragment="content" th:classappend="${isModal} ? '' : 'container py-4'">
  <h2 class="mb-4">Completar Cadastro</h2>

  <form th:action="@{${actionUrl}}" th:object="${usuario}" method="post" class="needs-validation" novalidate>
    <input type="hidden" th:field="*{id}" />

    <!-- Linha 1: Nome e Email -->
    <div class="row">
      <div class="col-12 col-md-8 mb-3">
        <label for="nome__${modalId}" class="form-label">Nome Completo</label>
        <input type="text" th:field="*{nome}" th:id="${'nome__' + modalId}" class="form-control" placeholder="Digite seu nome completo" required>
      </div>

      <div class="col-12 col-md-4 mb-3">
        <label for="email__${modalId}" class="form-label">E-mail</label>
        <input type="email" th:field="*{email}" th:id="${'email__' + modalId}" class="form-control" readonly>
      </div>
    </div>

    <!-- Linha 2: Nome Social e Identidade de Gênero -->
    <div class="row">
      <div class="col-12 col-md-8 mb-3">
        <label for="nomeSocial__${modalId}" class="form-label">Nome Social</label>
        <input type="text" th:field="*{nomeSocial}" th:id="${'nomeSocial__' + modalId}" class="form-control" placeholder="Se houver">
      </div>

      <div class="col-12 col-md-4 mb-3">
        <label for="identidadeGenero__${modalId}" class="form-label">Identidade de Gênero</label>
        <input type="text" th:field="*{identidadeGenero}" th:id="${'identidadeGenero__' + modalId}" class="form-control" placeholder="Como você se identifica">
      </div>
    </div>

    <!-- Linha 3: CPF, RG, Órgão Emissor -->
    <div class="row">
      <div class="col-12 col-md-4 mb-3">
        <label for="cpf__${modalId}" class="form-label">CPF</label>
        <input type="text" th:field="*{cpf}" th:id="${'cpf__' + modalId}" class="form-control" placeholder="000.000.000-00" required>
      </div>

      <div class="col-12 col-md-4 mb-3">
        <label for="rg__${modalId}" class="form-label">RG</label>
        <input type="text" th:field="*{rg}" th:id="${'rg__' + modalId}" class="form-control" placeholder="Número do RG">
      </div>

      <div class="col-12 col-md-4 mb-3">
        <label for="rgOrgao__${modalId}" class="form-label">Órgão Emissor</label>
        <input type="text" th:field="*{rgOrgao}" th:id="${'rgOrgao__' + modalId}" class="form-control" placeholder="Ex: SSP/PA">
      </div>
    </div>

    <!-- Linha 4: Data de Nascimento, Naturalidade, UF -->
    <div class="row">
      <div class="col-12 col-md-4 mb-3">
        <label for="dataNascimento__${modalId}" class="form-label">Data de Nascimento</label>
        <input type="date"
               th:field="*{dataNascimento}"
               th:id="${'dataNascimento__' + modalId}"
               class="form-control"
               required
               th:value="${usuario.dataNascimento != null} ? ${#temporals.format(usuario.dataNascimento, 'yyyy-MM-dd')} : ''">
      </div>

      <div class="col-12 col-md-4 mb-3">
        <label for="naturalidade__${modalId}" class="form-label">Naturalidade</label>
        <input type="text" th:field="*{naturalidade}" th:id="${'naturalidade__' + modalId}" class="form-control" placeholder="Cidade de nascimento">
      </div>

      <div class="col-12 col-md-4 mb-3">
        <label for="uf__${modalId}" class="form-label">UF</label>
        <input type="text" th:field="*{uf}" th:id="${'uf__' + modalId}" class="form-control" maxlength="2" placeholder="Ex: PA">
      </div>
    </div>

    <!-- Linha 5: Nome da Mãe e Nome do Pai -->
    <div class="row">
      <div class="col-12 col-md-6 mb-3">
        <label for="nomeMae__${modalId}" class="form-label">Nome da Mãe</label>
        <input type="text" th:field="*{nomeMae}" th:id="${'nomeMae__' + modalId}" class="form-control" placeholder="Nome completo da mãe">
      </div>

      <div class="col-12 col-md-6 mb-3">
        <label for="nomePai__${modalId}" class="form-label">Nome do Pai</label>
        <input type="text" th:field="*{nomePai}" th:id="${'nomePai__' + modalId}" class="form-control" placeholder="Nome completo do pai">
      </div>
    </div>

    <!-- Linha 6: Telefone e Perfil -->
    <div class="row">
      <div class="col-12 col-md-6 mb-3">
        <label for="telefone__${modalId}" class="form-label">Telefone</label>
        <input type="text" th:field="*{telefone}" th:id="${'telefone__' + modalId}" class="form-control" placeholder="(00) 00000-0000">
      </div>

      <div class="col-12 col-md-6 mb-3">
        <label for="perfil__${modalId}" class="form-label">Perfil</label>
        <select th:id="${'perfil__' + modalId}"
                class="form-select"
                th:field="*{perfil.id}"
                th:disabled="${!canEditPerfil}">
          <option value="" disabled selected>Selecione um perfil</option>
          <option th:each="p : ${perfis}"
                  th:value="${p.id}"
                  th:text="${p.descricao}">
          </option>
        </select>
      </div>
    </div>

    <!-- Linha 7: NIS e CNS -->
    <div class="row">
      <div class="col-12 col-md-6 mb-3">
        <label for="NIS__${modalId}" class="form-label">NIS</label>
        <input type="text" th:field="*{NIS}" th:id="${'nis__' + modalId}" class="form-control" placeholder="Número do NIS (PIS/PASEP)">
      </div>

      <div class="col-12 col-md-6 mb-3">
        <label for="CNS__${modalId}" class="form-label">CNS</label>
        <input type="text" th:field="*{CNS}" th:id="${'cns__' + modalId}" class="form-control" placeholder="Número do Cartão SUS">
      </div>
    </div>

    <!-- Botões -->
    <div class="d-flex flex-wrap gap-2 mt-3">
      <button type="submit" class="btn btn-primary">
        <i class="bi bi-save me-1"></i> Salvar
      </button>

      <button type="button"
              class="btn btn-secondary"
              th:if="${isModal}"
              data-bs-dismiss="modal">
        Cancelar
      </button>

      <button type="button"
              class="btn btn-secondary"
              th:if="${!isModal}"
              th:onclick="|window.location='@{/}'|">
        Cancelar
      </button>
    </div>
  </form>
</div>

<!-- JS Bootstrap e dependências -->


<!-- jQuery e máscaras -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

<script>
  $(document).ready(function() {
    function applyMasks(container) {
      container.find('input[id^="cpf"]').mask('000.000.000-00');
      container.find('input[id^="telefone"]').mask('(00) 00000-0000');
      //container.find('input[id^="nis"]').mask('000.00000.00-0');
      container.find('input[id^="cns"]').mask('000 0000 0000 0000');
    }

    // Página estática
    applyMasks($(document));

    // Modal
    $(document).on('shown.bs.modal', function(event) {
      var modal = $(event.target);
      applyMasks(modal);
    });
  });
</script>
